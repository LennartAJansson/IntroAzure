# To use Azure ServiceBus with SDK  

If you're going to communicate between different microservices and you would like to use a messagebroker then Azure offers a service named ServiceBus.  

The ServiceBus allows you to communicate with traditional Queues, async as well as sync but you also have full support for PubSub through Topics and Subscriptions where you could have one or several publishers and one or several subscribers.  

You can use the ServiceBus in its simplest form by referencing "Microsoft.Azure.ServiceBus" in your application or you could use an extension for the ServiceBus like the nuget package MassTransit.  

This excercise is about how to create a ServiceBus and how to use it with the SDK method.  

* Open the ```IntroAzure``` solution in Visual Studio  
* Edit ```AzureLogin.ps1```, change the subscription value to your own subscription id  
* Start a Powershell prompt  
* Switch to the folder where the ```IntroAzure``` solution exist  
* Run the script ```SetupServiceBus.ps1```  

### Queue
In Visual Studio, rightclick on ```BasicQueueListener``` project and select Manage User Secrets, it should contain:  
```
{
  "ServiceBus": {
    "ConnectionString": "The connectionstring generated by the script",
    "QueueName": "The queuename you used in your script"
  }
}
```  

Do exactly the same with ```BasicQueueSender```  

Startup ```BasicQueueListener``` first and once it's started you start up ```BasicQueueSender```. The output in both windows should show they are communicating.  

### PubSub with Topics and Subscriptions
Now continue with the project named ```BasicSubscriber```, Manage User Secrets and make sure it contain:
```
{
  "ServiceBus": {
    "ConnectionString": "The connectionstring generated by the script",
    "TopicName": "The topicname you used in your script",
    "SubscriptionName": "The subscriptionname you used in your script"
  }
}
```

In the project ```BasicPublisher``` change the User Secrets to:
```
{
  "ServiceBus": {
    "ConnectionString": "The connectionstring generated by the script",
    "TopicName": "The topicname you used in your script"
  }
}
```

Start the ```BasicSubscriber``` and once it's up and running you can start the ```BasicPublisher```. The output in both windows should show they are communicating.  

